<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%PUBLIC_URL%/favicon.ico" />

		<style>
			@font-face {
				font-family: neue-machina;
				src: url("/NeueMachina-Regular.woff2") format("woff2");
			}

			@font-face {
				font-family: gilroy-light;
				font-style: normal;
				font-weight: 400;
				src: local("Gilroy-Light"),
					url(https://fonts.cdnfonts.com/s/16219/Gilroy-Light.woff)
						format("woff");
			}

			body {
				font-family: neue-machina;
				background-image: url("./kycd-pearl-background-transparent.jpg");
				background-size: cover;
				font-weight: 400;
			}

			a {
				color: #181f60;
				font-family: gilroy-light;
			}

			.buttonHeaderButton-selected {
				background: white !important;
				border: solid;
				box-sizing: border-box;
				border-color: black white black black;
				border-bottom: white !important;
				color: black !important;
			}

			.buttonHeaderButton {
				cursor: pointer;

				background: black;
				color: white;

				border-radius: 5px;
				border-left-width: 1px;
				border-bottom-left-radius: 0;
				border-bottom-right-radius: 0;
				border: solid black;
				padding: 0.75em;
				border-width: 2px 1px 2px 1px;
				margin: 0;
			}

			.buttonHeaderButton:hover {
				background: #00ffb3;
				color: black;
				z-index: 0;
			}

			a:visited {
				color: #181f60;
				font-family: gilroy-light;
			}

			.buttonHeaderButton:first-child {
				border-left-width: 2px;
				border-top-right-radius: 0 !important;
			}

			.buttonHeaderButton:last-child {
				border-right-width: 2px;
				border-top-left-radius: 0 !important;
			}

			.chainSelectorButton {
				cursor: pointer;
				padding: 1em;
				border: solid black 2px;
				border-radius: 10%;
				background: black;
				color: white;
				border-radius: 5px;
			}

			.chainSelectorButton:hover {
				background-color: #00ffb3;
				color: black;
			}

			[type="checkbox"]:hover {
				cursor: pointer;
			}

			label {
				cursor: pointer;
			}

			.checkboxContaner {
				padding: 1em;
			}

			.dualButton {
				display: flex;
				box-sizing: content-box;
			}

			.dualButton > .chainSelectorButton:first-child {
				border-end-end-radius: 0;
				border-start-end-radius: 0;
				border-right-style: solid;
			}

			.dualButton > .chainSelectorButton:last-child {
				border-start-start-radius: 0;
				border-end-start-radius: 0;
				border-left-style: none;
			}

			#faucetContainer {
				margin-bottom: 2em;
				display: flex;
				flex-direction: column;
				flex: 1;
			}

			#buttonContainer {
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				margin-inline: 1em;
				height: 100vh;
				position: relative;
				box-sizing: border-box;
			}

			#buttonsContainer {
				display: flex;
				justify-content: space-around;
				flex-wrap: wrap;
				gap: 1em;
				padding: 1em;
				margin-bottom: 2em;
				border: solid black 2px;
				border-radius: 5px;
				border-top-right-radius: 0;
				border-top-left-radius: 0;
				background-color: white;
			}

			.flexRow {
				display: flex;
				flex-direction: row;
			}

			.flexCol {
				display: flex;
				flex-direction: column;
			}

			div.typeSelectorContainer {
				position: relative;
				bottom: -2px;
				z-index: 2;
			}

			.centered {
				text-align: center;
				margin-bottom: 1em;
			}

			.flex-1 {
				flex: 1;
			}

			body {
				min-height: 100vh;
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
		</style>

		<script
			src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"
			integrity="sha256-OfIB2zuUgSYcwWYMPC+YgPsJ70TB5f5dni/Z3rgYvRA="
			crossorigin="anonymous"></script>

		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#000000" />
		<meta
			name="description"
			content="Web site created using create-react-app" />
		<link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
		<!--<link rel="manifest" href="%PUBLIC_URL%/asset-manifest.json" /> -->
		<title>Widget Example App</title>
		<script>
			const walletConnectEvmProvider = new WalletConnectProvider.default({
				rpc: {
					1: "https://rpc.ankr.com/eth",
					5: "https://rpc.ankr.com/eth_goerli",
					137: "https://rpc-mainnet.maticvigil.com/",
					80001: "https://rpc-mumbai.maticvigil.com/",
					44787: "https://alfajores-forno.celo-testnet.org",
				},
				chainId: 80001,
			})
			const autostart = false

			let mode = localStorage.getItem("mode") || "integrated"

			function handleModeClick(btn) {
				const typeSelectorChildren = document.getElementsByClassName(
					"typeSelectorContainer"
				)[0].children

				for (const item of typeSelectorChildren) {
					item.classList.remove("buttonHeaderButton-selected")
				}

				if (btn.innerText === "Integrated modal") {
					mode = "integrated"
				} else if (btn.innerText === "iFrame modal") {
					mode = "iframe"
				}

				localStorage.setItem("mode", mode)

				btn.classList.add("buttonHeaderButton-selected")
			}

			const chains = [
				"PolygonMumbai",
				"CeloAlfajores",
				"SolanaDevnet",
				"NearTestnet",
				"EthereumGoerli",
			]

			onload = () => {
				const integratedTypeButton = document.getElementsByClassName(
					"typeSelectorContainer"
				)[0].children

				const currentTypeButton =
					integratedTypeButton[mode === "integrated" ? 0 : 1]
				currentTypeButton.classList.add("buttonHeaderButton-selected")

				const config = {
					isModal: true,
					nearAutorunEnabled: true,
					container: "#modalRoot",
					config: {
						demoMode: true,
						enabledBlockchainNetworks: chains,
						enabledVerificationTypes: ["KYC"],
						evmProvider: window.ethereum,
						baseUrl: "https://staging.kycdao.xyz",
					},
					onReady: (sdkInstance) => {
						let nftCheckInterval

						function writeNFT() {
							if (sdkInstance.kycDao.connectedWallet) {
								sdkInstance.kycDao
									.hasValidNft("KYC")
									.then((value) => {
										console.log(
											`This wallet ${value ? "has" : "has not"} a valid nft.`
										)
									})
									.catch(console.error)
								clearInterval(nftCheckInterval)
							}
						}

						nftCheckInterval = setInterval(writeNFT, 1000)
					},
					onSuccess: (data) => {
						if (data) {
							const i = /Already has an nft on (.*)\./g.exec(data)

							if (i) {
								console.log(`Already has an nft on ${i[1]}.`)
							}
						}
					},
				}

				const iframeConfig = {
					container: "#modalRoot",
					backdrop: true,
					isModal: true,
					nearAutorunEnabled: true,
					url: `${window.location.origin}/iframe.html`,
					messageTargetOrigin: window.location.origin,
					config: {
						demoMode: true,
						enabledBlockchainNetworks: chains,
						enabledVerificationTypes: ["KYC"],
						evmProvider: "ethereum",
						baseUrl: "https://staging.kycdao.xyz",
					},
					onReady: () => {},
					onSuccess: (data) => {
						if (data) {
							const i = /Already has an nft on (.*)\./g.exec(data)

							if (i) {
								console.log(`Already has an nft on ${i[1]}.`)
							}
						}
					},
					onFail: () => {},
				}

				let kycDaoWidget
				let kycDaoIframeWidget

				// This is needed for the near autostart. Somehow, they should be not run, if no near redirect happened. This should create and error, if someone runs an iframe after an integrated modal. Had no time, sorry. :(
				if (mode === "integrated") {
					kycDaoWidget = KycDaoWidget.init(config)
				} else if (mode === "iframe") {
					kycDaoIframeWidget = KycDaoIframeWidget.init(iframeConfig)
				}

				globalThis.selectorHandler = function (selectedChain, walletConnectOn) {
					if (walletConnectOn) {
						if (mode === "integrated") {
							const newConfig = { ...config }
							newConfig.config.evmProvider = walletConnectEvmProvider

							kycDaoWidget.open(selectedChain, newConfig)
						} else if (mode === "iframe") {
							const newConfig = {
								...iframeConfig,
								config: {
									...iframeConfig.config,

									evmProvider: "walletConnect",
								},
							}

							console.log(newConfig)

							kycDaoIframeWidget.open(selectedChain, newConfig)
						}
					} else {
						if (mode === "integrated") {
							kycDaoWidget.open(selectedChain)
						} else if (mode === "iframe") {
							kycDaoIframeWidget.open(selectedChain)
						}
					}
				}

				if (autostart) {
					const walletConnectOn = false

					selectorHandler(chains[0], walletConnectOn)
				}
			}
		</script>
	</head>

	<body>
		<noscript>You need to enable JavaScript to run this app.</noscript>
		<div id="modalRoot"></div>
		<div id="buttonContainer">
			<div id="flexCol">
				<h1 class="centered">Select your chain</h1>
				<div id="flexRow">
					<div class="flexRow typeSelectorContainer">
						<h3
							onclick="handleModeClick(this)"
							class="typeHeader buttonHeaderButton">
							Integrated modal
						</h3>
						<h3
							onclick="handleModeClick(this)"
							class="typeHeader buttonHeaderButton">
							iFrame modal
						</h3>
					</div>
					<div id="buttonsContainer">
						<div class="dualButton">
							<div
								class="chainSelectorButton"
								onclick="selectorHandler('CeloAlfajores', false)">
								Celo Testnet (Alfajores)
							</div>
							<div
								class="chainSelectorButton"
								onclick="selectorHandler('PolygonMumbai', true)">
								with WalletConnect
							</div>
						</div>
						<div class="dualButton">
							<div
								class="chainSelectorButton"
								onclick="selectorHandler('PolygonMumbai', false)">
								Polygon Testnet (Mumbai)
							</div>
							<div
								class="chainSelectorButton"
								onclick="selectorHandler('PolygonMumbai', true)">
								with WalletConnect
							</div>
						</div>
						<div
							class="chainSelectorButton"
							onclick="selectorHandler('SolanaDevnet', true)">
							Solana Devnet
						</div>
						<div
							class="chainSelectorButton"
							onclick="selectorHandler('NearTestnet', false)">
							NEAR Testnet
						</div>
						<div class="dualButton">
							<div
								class="chainSelectorButton"
								onclick="selectorHandler('EthereumGoerli', false)">
								Ethereum Testnet (Goerli)
							</div>
							<div
								class="chainSelectorButton"
								onclick="selectorHandler('EthereumGoerli', true)">
								with WalletConnect
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<div id="faucetContainer">
					<div class="flex-1">
						<strong>FAUCETS for testing:</strong>
						<div>
							<strong>Alfajores</strong>
							faucet:
							<a href=" https://celo.org/developers/faucet" target="_blank">
								https://celo.org/developers/faucet
							</a>
						</div>
						<div>
							<strong>Mumbai</strong>
							Faucet1:
							<a href="https://faucet.polygon.technology" target="_blank">
								https://faucet.polygon.technology
							</a>
						</div>
						<div>
							<strong>Mumbai</strong>
							Faucet2:
							<a href="https://mumbaifaucet.com" target="_blank">
								https://mumbaifaucet.com
							</a>
						</div>
						<div>
							<strong>Goerli</strong>
							faucet list:
							<a href="https://faucetlink.to/goerli" target="_blank">
								https://faucetlink.to/goerli
							</a>
						</div>
						<div>
							<strong>Near:</strong>
							Test wallet has testnet tokens.
						</div>
					</div>
					<div style="flex: 1"></div>
				</div>
				<div class="centered">
					If you have any questions, ask us on
					<a target="_blank" href="https://discord.kycDAO.xyz">
						discord.kycDAO.xyz
					</a>
					<p>
						<a href="https://github.com/kycdao/widget" target="_blank">
							<%= htmlWebpackPlugin.options.packageName %>
						</a>
						v<%= htmlWebpackPlugin.options.packageVersion %>+<%=
						htmlWebpackPlugin.options.hash %>
					</p>
				</div>
			</div>
		</div>
	</body>
</html>
